---
title: ğŸšª ç†è§£æ‰€æœ‰æƒ
layout: post
author: cyven
tags: rust ownership reference stack heap
categories: CS CS::Lang CS::Lang::Rust
---


# Table of Contents

1.  [æ‰€æœ‰æƒæ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ](#org1481708)
    1.  [å†…å­˜å®‰å…¨é—®é¢˜](#org8556d6f)
        1.  [answer](#org9503f0d)
    2.  [ä¹‹å‰çš„è§£å†³æ–¹å¼](#org97dab9a)
2.  [Rustæ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ](#org1cf9bef)
    1.  [ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒå‘¢ï¼Ÿ](#org5abb07c)
    2.  [æ‰€æœ‰è€…æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ](#org7a4017c)
    3.  [é‡Šæ”¾å€¼ä»€ä¹ˆæ„æ€ï¼Ÿå®ƒä»¬æœ¬æ¥åœ¨å“ªï¼Ÿ](#orge61e11e)
        1.  [å€¼å­˜åœ¨å“ªé‡Œï¼Ÿ](#org485c591)
        2.  [å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å˜åŒ–,ebpå’Œespçš„å˜åŒ–](#org2b1e9be)
    4.  [ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œé‚£ let y = x å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ](#org36a48b7)
    5.  [å“ªè¿˜æœ‰é‚£äº›ä¼šå‘ç”Ÿè½¬ç§»çš„](#orgf5ea0e9)
    6.  [é‚£ç¨‹åºä¸­è‚¯å®šæœ‰å¾ˆå¤šå€¼ä¼ æ¥ä¼ å»ï¼Œæ‰€æœ‰æƒè½¬ç§»æ¥è½¬ç§»å»ï¼Œè¿˜è¦é€šè¿‡è¿”å›å€¼å»æŠŠæ‰€æœ‰æƒæ¥å—å›æ¥ï¼Œé‚£å²‚ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Ÿ](#org5895332)
    7.  [æ€ä¹ˆç”¨å¼•ç”¨è·å–å€¼ï¼Ÿ](#org675c298)
    8.  [é‚£æ„æ€æ˜¯åªæ˜¯å¯è¯»ï¼Ÿ](#org064735c)
    9.  [è¯¶ï¼Ÿä¼šä¸ä¼šæœ‰ä¸€ç§æƒ…å†µæ˜¯åŸæ¥çš„å€¼è¢«é‡Šæ”¾äº†ï¼Œä½†æ˜¯å¼•ç”¨è¿˜åœ¨ï¼Œæ€ä¹ˆåŠï¼Ÿ](#org50a7178)
    10. [æ‰€æœ‰æƒç³»ç»Ÿæ€ä¹ˆä¿è¯å†…å­˜å®‰å…¨ï¼Ÿ](#org48360e0):drill:
        1.  [æˆ‘çš„æ€è€ƒ](#org41ca34d)
3.  [æ¡ˆä¾‹åˆ†æ](#orgd48212f)
    1.  [é‚£è¿™é‡Œç¨‹åºåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ‰€æœ‰æƒæ˜¯æ‹¥æœ‰å€¼è¿˜æ˜¯æ‹¥æœ‰å†…å­˜ç©ºé—´](#org14c9248)




# æ‰€æœ‰æƒæ˜¯è§£å†³ä»€ä¹ˆé—®é¢˜çš„ï¼Ÿ {#org1481708}

å…ˆä¸ç®¡æ‰€æœ‰æƒçš„å®šä¹‰æ˜¯ä»€ä¹ˆï¼Œ

1.  å…ˆææ¸…æ¥šæ‰€æœ‰æƒæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜è€Œæå‡ºçš„
2.  ä¹‹å‰æ˜¯æ€ä¹ˆè§£å†³è¿™äº›é—®é¢˜çš„



## å†…å­˜å®‰å…¨é—®é¢˜      {#org8556d6f}

ä»€ä¹ˆæ˜¯å†…å­˜å®‰å…¨é—®é¢˜ï¼Ÿ



### answer {#org9503f0d}

æ‰€æœ‰çš„ç¨‹åºéƒ½å¿…é¡»å’Œè®¡ç®—æœºå†…å­˜æ‰“äº¤é“ï¼Œå¦‚ä½•ä»å†…å­˜ç©ºé—´ç”³è¯·ç©ºé—´å­˜æ”¾ç¨‹åºçš„è¿è¡Œå†…å®¹ã€‚
è¿™æ˜¯åŸºç¡€
é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå› ä¸ºè®¡ç®—æœºçš„å†…å­˜èµ„æºæ˜¯å¾ˆå®è´µçš„ï¼Œå¦‚ä½•åœ¨ç”³è¯·ç©ºé—´ä¸ç”¨äº†ä¹‹åå»é‡Šæ”¾æ‰è¿™äº›ç©ºé—´ï¼Œå°±æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜

è¿™å°±æ˜¯å†…å­˜å®‰å…¨é—®é¢˜ã€‚å› ä¸ºå¦‚æœæ²¡æœ‰é‡Šæ”¾æ‰ï¼Œé‚£äº›ç¨‹åºä¸ç”¨äº†çš„æ•°æ®å ç€èŒ…å‘ä¸æ‹‰å±ï¼Œå°±æ˜¯æ‰€è°“çš„å†…å­˜æ³„æ¼ã€‚



## ä¹‹å‰çš„è§£å†³æ–¹å¼ {#org97dab9a}

åœ¨è®¡ç®—æœºå‘å±•ä»¥æ¥ï¼Œä¸»è¦æ˜¯ä¾èµ–ä¸¤ç§æ–¹å¼

1.  æ‰‹åŠ¨ï¼Œè¿è¡Œæ—¶ã€‚ æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œåœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡è°ƒç”¨å‡½æ•°æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œæ¯”å¦‚C/C++
    é‚£ä¹ˆè¿™ç§è®¾è®¡ï¼Œç¼–å†™ç¨‹åºçš„è‡ªç”±çµæ´»åº¦å¾ˆé«˜ï¼Œç¨‹åºæ€§èƒ½å¥½ï¼Œä½†æ˜¯æ­£æ˜¯å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚å¾ˆé«˜
2.  è‡ªåŠ¨ï¼Œè¿è¡Œæ—¶ã€‚ å†…å­˜å›æ”¶æœºåˆ¶ GCï¼Œç¨‹åºè‡ªåŠ¨çš„å»æ‰¾é‚£äº›ç”¨ä¸åˆ°çš„å†…å­˜åŒºåŸŸï¼Œå»å›æ”¶ï¼Œæ¯”å¦‚Java/GO
    ä½†æ˜¯å› ä¸ºæ˜¯åƒåœ¾å›æ”¶æ˜¯è‡ªåŠ¨çš„ï¼Œæ‰€ä»¥ä»–çš„ä»£ä»·æ˜¯æ€§èƒ½é—®é¢˜ï¼ˆstop the worldï¼‰ï¼Œå†…å­˜å ç”¨ï¼ˆåƒåœ¾å›æ”¶ç¨‹åºæ˜¯ä¸€ä¸ªç¨‹åºï¼Œéœ€è¦è¿è¡Œç©ºé—´æ¥ä¿å­˜ä¸€äº›æ•°æ®ï¼‰
    è¿™ç§åœ¨é«˜æ€§èƒ½ï¼Œç³»ç»Ÿçº§ç¼–ç¨‹ä¸Šæ˜¯ä¸èƒ½é€‚åˆçš„ã€‚



# Rustæ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Ÿ {#org1cf9bef}

> Rust is a modern system programming language focused on performance, safety, and concurrency.It accomplishes these goals without having a garbage collector

Rustçš„å®šä½æ˜¯ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯å®ƒå¼•å…¥äº† æ‰€æœ‰æƒ æ¥è§£å†³å†…å­˜å®‰å…¨é—®é¢˜



## ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒå‘¢ï¼Ÿ {#org5abb07c}

> Ownership is a set of rules that govern how a Rust program manages memory.

ä¸Šé¢ä¸¤ç§ä¿æŠ¤å†…å­˜å®‰å…¨çš„æ–¹å¼ï¼Œéƒ½æ˜¯è¿è¡Œæ—¶ï¼Œé‚£ä¹ˆæ‰€æœ‰æƒåœ¨è®¾è®¡ä¸Šé€‰æ‹©äº†åœ¨ç¼–è¯‘æ—¶ä¿æŠ¤ã€‚
ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—çš„è§„åˆ™è¿›è¡Œæ£€æŸ¥ã€‚å¦‚æœè¿åäº†ä»»ä½•è¿™äº›è§„åˆ™ï¼Œç¨‹åºéƒ½ä¸èƒ½ç¼–è¯‘ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæ‰€æœ‰æƒç³»ç»Ÿçš„ä»»ä½•åŠŸèƒ½éƒ½ä¸ä¼šå‡æ…¢ç¨‹åºã€‚

æ‰€ä»¥ä»€ä¹ˆè§„åˆ™å…¶å®å°±æ˜¯è§£é‡Šäº†æ‰€æœ‰æƒçš„æ¦‚å¿µ

æ‰€æœ‰æƒè§„åˆ™

1.  Each value in Rust has an owner.
2.  There only be one owner at a time.
3.  when the owner goes out of scope, the value will be dropped.

ä»»ä½•æ—¶å€™ä¸€ä¸ªå€¼æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œç„¶åè¿™ä¸ªå€¼éšç€æ‰€æœ‰è€…çš„ä½œç”¨åŸŸç»“æŸå°±é‡Šæ”¾æ‰äº†



## æ‰€æœ‰è€…æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ {#org7a4017c}

è¿™é‡Œå°±æ˜¯æ¶‰åŠåˆ° **å˜é‡ç»‘å®š**
å…¶å®å°±æ˜¯èµ‹å€¼ï¼Œä½†æ˜¯åœ¨Rustæˆ‘ä»¬å®šä¹‰èµ‹å€¼çš„å·¦å¼ä¸ºæ‰€æœ‰è€…ï¼Œ
è¿™ä¹ˆå«å°±æ˜¯ä¸ºäº†æ˜ç¡®æ‰€æœ‰æƒæ¦‚å¿µ



## é‡Šæ”¾å€¼ä»€ä¹ˆæ„æ€ï¼Ÿå®ƒä»¬æœ¬æ¥åœ¨å“ªï¼Ÿ      {#orge61e11e}

when the owner goes out of scope, the value will be dropped
è¿™é‡Œçš„é‡Šæ”¾æ˜¯ä»€ä¹ˆæ„æ€ï¼Œåœ¨å“ªé‡Œé‡Šæ”¾ï¼Œæ€ä¹ˆé‡Šæ”¾ï¼Ÿ



### å€¼å­˜åœ¨å“ªé‡Œï¼Ÿ {#org485c591}

è¿™å°±æ¶‰åŠåˆ°æ ˆå’Œå †çš„æ¦‚å¿µäº†ï¼Œ
è¿™ä¸¤ä¸ªæ˜¯ç¼–ç¨‹è¯­è¨€ä¸­æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„

è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µå«æ ˆå¸§

æ³¨æ„ï¼Œæ ˆæ˜¯æ•°æ®ç»“æ„ï¼Œæ˜¯æŠ½è±¡çš„ï¼Œæ ˆå¸§æ˜¯ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç³»ç»Ÿåˆ†é…çš„ä¸€å—ç‹¬ç«‹çš„ç©ºé—´ï¼Œæ˜¯ç‰©ç†çš„ï¼Œè¿™ä¸ªç©ºé—´ä½¿ç”¨æ ˆç»“æ„å®ç°çš„ã€‚

è¿™æ ·ï¼Œåœ¨ä¸€ä¸ªå‡½æ•°é‡Œé¢æ‰€ç”¨åˆ°çš„ çŠ¶æ€å’Œå˜é‡ å°±è¢«ä¿å­˜åœ¨æ ˆå¸§é‡Œé¢

å¯¹äºä¸€ä¸ªè¿è¡Œä¸­çš„å‡½æ•°ï¼Œå…¶ä½¿ç”¨çš„æ ˆå¸§åŒºåŸŸè¢«spå’Œbpå¯„å­˜å™¨é™å®š
ï¼ˆå¯¹äºx86ï¼Œspç­‰ä»·espï¼Œbpç­‰ä»·rspï¼›å¯¹äºx64ï¼Œspç­‰ä»·rspï¼Œbpç­‰ä»·rbpï¼‰ã€‚
bpæŒ‡å‘æ ˆå¸§çš„åº•éƒ¨ï¼ŒspæŒ‡å‘æ ˆå¸§çš„é¡¶éƒ¨ã€‚

è¯¶ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å˜é‡çš„ç±»å‹ï¼Œåˆ†ä¸ºå›ºå®šå¤§å°å’Œå¯å˜çš„ï¼Œé‚£ä¹ˆè¿™äº›å¯å˜çš„æ€ä¹ˆä¿å­˜åœ¨æ ˆé‡Œé¢ï¼Ÿ

æ‰€ä»¥ä¸ºäº†æ€§èƒ½ï¼ˆæ ˆæŒ‡é’ˆçš„ç§»åŠ¨å°±ä»¥å›ºå®šå¤§å°æ¥ç§»åŠ¨ï¼‰å’Œå¯å˜å¤§å°æ•°æ®çš„ä¿å­˜ï¼Œå¼•å…¥äº†å †

è®¡ç®—æœºç¨‹åºçš„è¿è¡Œä¾èµ–æ ˆå’Œå †æ¥æ¨è¿›ç¨‹åºçš„æ¨è¿›

æ ˆé‡Œé¢çš„æ•°æ®æ˜¯å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚ä¸€äº›åŸºç¡€ç±»å‹ï¼Œintï¼Œfloatï¼Œcharç­‰
è€Œé‚£äº›ä¸çŸ¥é“å¤§å°çš„ä¹Ÿå°±æ˜¯åŠ¨æ€çš„ï¼Œå¯å˜å¤§å°çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡ï¼Œç»“æ„ä½“ï¼ŒStringç­‰ï¼Œå°±æ”¾åœ¨å †é‡Œ

åœ¨å †ä¸Šæ”¾å…¥æ•°æ®ï¼Œéœ€è¦ç”³è¯·å’Œåˆ†é…ï¼Œç„¶åæ€ä¹ˆè®¿é—®å‘¢ï¼Ÿåˆ†é…å®Œåä¼šç»™ä½ ä¸€ä¸ªåœ°å€ï¼Œåœ¨ç¨‹åºä¸­è¿™ä¸ªåœ°å€åˆå«æŒ‡é’ˆ
ç„¶åæ ˆé‡Œé¢ä¿å­˜çš„æ˜¯è¿™ä¸ªæŒ‡é’ˆï¼Œä¿å­˜è¿™ä¸ªæŒ‡é’ˆçš„å˜é‡æ˜¯æŒ‡é’ˆç±»å‹çš„å˜é‡

æˆ‘ç†è§£çš„å˜é‡ï¼Œæ˜¯å˜é‡å+å˜é‡åœ°å€ï¼ˆæ ˆç©ºé—´çš„åœ°å€ï¼‰ï¼Œå˜é‡åæ˜¯ä¸ºäº†è®©ç¨‹åºå‘˜æ–¹ä¾¿ä»¥äººç±»è¯­è¨€å»å†™ä»£ç çš„ï¼Œ
å®ƒä¼šåœ¨ç¼–è¯‘ååœ¨åº•å±‚æ‰§è¡Œçš„æ—¶å€™å˜æˆè¿™ä¸ªå˜é‡åœ°å€ï¼Œè¿™æ˜¯ç»™æœºå™¨çœ‹çš„

ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªå˜é‡åŸºæœ¬ä¸Šä½œç”¨åŸŸå°±æ˜¯åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ï¼Œ

è¯¶ä¸å¯¹å•Šï¼Œä¸€ä¸ªå‡½æ•°ç»“æŸäº†ï¼Œè¿™ä¸ªå˜é‡å°±æ²¡äº†ï¼Ÿ æ˜¯çš„ï¼Œé™¤éä»–æ˜¯å…¨å±€å˜é‡ï¼Œé‚£è¿™ä¸ªå˜é‡ä¸ä¿å­˜åœ¨æ ˆå¸§ä¸­

é‚£æ€ä¹ˆæ„Ÿè§‰ç¨‹åºèƒ½è¿è¡Œè¿™ä¹ˆä¹…å‘¢ï¼Ÿ æ˜¯å› ä¸ºå‡½æ•°ä¸­æœ‰è°ƒç”¨å…¶ä»–å‡½æ•°å•Š

è¿™ä¸ªå˜é‡å¯ä»¥é€šè¿‡ å‚æ•°ä¼ é€’çš„æ–¹å¼ï¼Œè¿›å…¥åˆ°å¦ä¸€ä¸ªå‡½æ•°çš„æ ˆå¸§ä¸­ï¼Œè€Œè¿™é‡Œè¿™ä¸ªä¼ é€’ï¼Œå°±æ˜¯å¤åˆ¶å€¼åˆ°è°ƒç”¨å‡½æ•°çš„ç©ºé—´ã€‚



### å‡½æ•°è°ƒç”¨æ—¶æ ˆçš„å˜åŒ–,ebpå’Œespçš„å˜åŒ– {#org2b1e9be}

è¯¦ç»†å¯çœ‹ [å‡½æ•°è°ƒç”¨å’Œæ ˆçš„å˜åŒ–](https://luckyfuture.top/StackAndFuncCall#%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90) ï¼Œebpå’Œespçš„å˜åŒ–

    fn main(){
        a();
    }
    fn a(){
        let x = 5;
        let y = "hello world";
        let z = 11.3;
        b(x,y,z);
    }

    fn b(x:i32,y:&str,z:f64){
        println!("x:{x}\ny:{y}\nz:{z}");
    }


```
: x:5
: y:hello world
: z:11.3
```

é¦–å…ˆæ¯ä¸ªå‡½æ•°åœ¨å¼€å§‹çš„æ—¶å€™ä¼šåšçš„ä¸€ä»¶äº‹æ˜¯

1.  å…ˆå°†ebpå…¥æ ˆï¼Œæ­¤æ—¶çš„ebpæŒ‡å‘çš„æ˜¯è°ƒç”¨è€…å‡½æ•°æ ˆå¸§çš„åŸºåº•
    ç›®çš„æ˜¯ä¿å­˜è°ƒç”¨å‡½æ•°çš„æ ˆçŠ¶æ€
    åœ¨ä¸Šé¢aå‡½æ•°å¼€å§‹çš„æ—¶å€™ï¼Œä¼šå°†mainå‡½æ•°çš„ebpå…¥æ ˆ
2.  ç„¶åå°†ebpå˜æˆespï¼Œæ­¤æ—¶å¼€å§‹å°±æ˜¯ è¢«è°ƒç”¨å‡½æ•°çš„æ ˆå¸§ç©ºé—´äº†
    ä¸Šé¢aå‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œæœ‰å±€éƒ¨å˜é‡x,y,z,å°±ä¾æ¬¡å‹æ ˆï¼ŒespæŒ‡å‘æ ˆé¡¶

åœ¨aè°ƒç”¨b æ—¶å‘ç”Ÿçš„äº‹æƒ…

3.  ä»å³å¾€å·¦ï¼Œä¾æ¬¡å‹æ ˆz,y,xã€‚æ­¤æ—¶è¿›å…¥çš„è¿˜æ˜¯aå‡½æ•°çš„æ ˆå¸§ç©ºé—´
4.  åº•å±‚åœ¨æ‰§è¡Œ callæŒ‡ä»¤ å»å®ç° aè°ƒç”¨bå‡½æ•°ï¼Œè¿™æ—¶å€™ï¼Œä¼šå…ˆå°†æ‰§è¡Œåˆ°aå‡½æ•°çš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ï¼ŒPCå¯„å­˜å™¨å…¥æ ˆï¼Œè¿™ä¸ªå°±æ˜¯è¿”å›åœ°å€
    æ­¤æ—¶espå’Œebp æ„æˆçš„åŒºåŸŸè¿˜æ˜¯aå‡½æ•°çš„æ ˆå¸§ç©ºé—´
5.  æ‰§è¡Œbå‡½æ•°æŒ‡ä»¤åºåˆ—ï¼ŒåŒæ ·çš„ä¼šå…ˆåšä¸Šé¢ä¿å­˜ç°åœºçš„ä¸¤ä»¶äº‹
    æ‰€ä»¥ä¸€ä¸ªå‡½æ•°çš„æ ˆå¸§ç©ºé—´,åœ¨æœ‰è°ƒç”¨å‘ç”Ÿçš„æ—¶å€™ï¼Œå®Œæ•´çš„ç©ºé—´åˆ†å¸ƒæ˜¯è¿™æ ·å­çš„

![2024-04-26-15-25-30-screenshoot.png](../assets/img/2024-04-26-15-25-30-screenshoot.png)

åªæ˜¯è¿™ä¸ªEBPçš„å…¥æ ˆæ˜¯ è¢«è°ƒç”¨å‡½æ•° å¸®å¿™åšçš„

6.  å¼€å§‹æ‰§è¡Œbå‡½æ•°çš„æŒ‡ä»¤åºåˆ—

è°ƒç”¨å®Œæˆåè¿”å›æ—¶å‘ç”Ÿçš„äº‹æƒ…

7.  ä¸€èˆ¬è¿™æ—¶å€™çš„æŒ‡ä»¤åºåˆ—æ˜¯

    pop ebp

    ret

    æœ‰çš„æ—¶å€™æ˜¯

	leave

	ret

	leaveå…¶å®æ˜¯

	mov esp,ebp

	pop ebp

	å°±å¤šäº†ä¸€ä¸ªmov esp,ebpæ“ä½œ

	è¿™é‡Œè¿™ä¹ˆåšå°±æ˜¯ä¸ç®¡æ­¤æ—¶æ ˆé¡¶åœ¨å“ªï¼Œå›åˆ°æ ˆåº•ï¼Œé‚£ä¹‹å‰çš„å°±å½“ä½œé‡Šæ”¾äº†

	æ­¤æ—¶è™½ç„¶espæŒ‡å‘çš„æ˜¯ebp

	ç„¶åä¼šæ‰§è¡Œ pop ebpï¼Œå› ä¸ºè°ƒç”¨ç»“æŸäº†ä¹ˆï¼Œæ­¤æ—¶æ ˆé¡¶ä¸€èˆ¬å°±æ˜¯å‡½æ•°ä¸€å¼€å§‹æ‰§è¡Œçš„å°†ebpå…¥æ ˆçš„æ“ä½œçš„ebp

	å°†æ­¤æ—¶æ ˆé‡Œé¢çš„æ ˆé¡¶å…ƒç´ èµ‹ç»™ebpï¼Œespé€€ä¸€æ ¼

	ç„¶åæ‰§è¡Œret

	retå…¶å®æ˜¯è¿™ä¸¤ä¸ªæŒ‡ä»¤

	pop eip

	jmp return_addr

	ä¸Šä¸€ä¸ªæ ˆé¡¶å…ƒç´ æ˜¯ä¿å­˜çš„EBPï¼Œè¢«popå‡ºæ¥åï¼Œè¿™æ—¶å€™çš„æ ˆé¡¶å…ƒç´ æ˜¯callæŒ‡ä»¤ä¿å­˜çš„è¿”å›åœ°å€
    ç„¶åé€šè¿‡jmpæŒ‡ä»¤ç»§ç»­ è°ƒç”¨å‡½æ•°çš„æŒ‡ä»¤æ‰§è¡Œ



## ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œé‚£ let y = x å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ {#org36a48b7}

è¿™å°±æ¶‰åŠåˆ°æ•°æ®çš„äº¤äº’ï¼Œä»¥åŠæ‰€æœ‰æƒçš„è½¬ç§»

å¯¹äºåŸºæœ¬ç±»å‹
let x = 5;
let y = x;

æ•´ä¸ªè¿‡ç¨‹çš„èµ‹å€¼éƒ½æ˜¯é€šè¿‡ å€¼æ‹·è´ çš„æ–¹å¼åœ¨æ ˆä¸Šå®Œæˆçš„
è¿™é‡Œæ²¡æœ‰å‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»
è€Œæ˜¯xæ˜¯0x123ä¸­5çš„æ‰€æœ‰è€…ï¼Œyæ˜¯0x456ä¸­çš„æ‰€æœ‰è€…

ä½†å…¶å®æ‰€æœ‰è€…æ›´å¤šçš„è¿˜æ˜¯é’ˆå¯¹ å †ä¸Šçš„æ•°æ®

let s1 = String::from("hello world");
let s2 = s1;

è¿™é‡Œ s1 çš„å€¼æ˜¯ä¸€ä¸ªStringç±»å‹ï¼Œä»–æ˜¯å­˜å‚¨åœ¨å †ä¸Šçš„ï¼Œä»–ä¸èƒ½è‡ªåŠ¨æ‹·è´

s1å˜é‡æ˜¯å­˜åœ¨æ ˆä¸Šçš„ï¼Œæ ˆä¸Šçš„ç»“æ„æ˜¯

å †æŒ‡é’ˆï¼šæŒ‡å‘å †é‡ŒçœŸå®å­˜å‚¨å­—ç¬¦ä¸²çš„åœ°å€
å­—ç¬¦ä¸²é•¿åº¦ï¼šç›®å‰ä½¿ç”¨çš„é•¿åº¦
å­—ç¬¦ä¸²å®¹é‡ï¼šå †å†…å­˜åˆ†é…ç©ºé—´çš„å¤§å°

è¿™æ ·ç»„æˆçš„å›ºå®šå¤§å°çš„ç±»å‹

å…¶ä»–è¯­è¨€å¯èƒ½å°±ä¸€ä¸ªæŒ‡é’ˆï¼Œå…¶ä»–ä¿¡æ¯æ”¾åœ¨å †ä¸­ï¼Œæ¯”å¦‚Java

åœ¨Javaä¸­ï¼Œè¿™é‡Œçš„èµ‹å€¼ï¼Œå…¶å®å°±æ˜¯å¼•ç”¨çš„èµ‹å€¼ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘äº†å†…å­˜ä¸­çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­ä¸€ä¸ªåŠ¨äº†ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªå°±èƒ½æ„Ÿå—åˆ°

    public static class Person{
        private String name;
        private int age;

        public Person(String name,int age){
            this.name = name;
            this.age = age;
        }
        public void setAge(int age){
            this.age = age;
        }
        @Override
        public String toString(){
            return "name = "+name+"\n"+"age = "+age;
        }
    }

    public static void main(String[] args){
        Person p1 = new Person("cy",29);
        Person p2 = p1;
        System.out.println(p1);
        System.out.println(p2);
        p1.setAge(30);
        System.out.println(p2);
    }


```
: name = cy
: age = 29
: name = cy
: age = 29
: name = cy
: age = 30

```

è€Œè¿™æ ·åœ¨Rustä¸­æ˜¯ä¸å…è®¸çš„

å› ä¸ºåƒç±»ä¼¼Javaè¯­è¨€ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªæŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜ï¼Œè¿™å°±æ„å‘³ç€è¿™å—å†…å­˜ä¸æ˜ç¡®ä»€ä¹ˆæ—¶å€™å¯ä»¥è¢«é‡Šæ”¾

å› ä¸ºå¦‚æœé©¬ä¸Šéšç€ç¬¬ä¸€ä¸ªå˜é‡çš„ä½œç”¨åŸŸç»“æŸè€Œé‡Šæ”¾çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–åœ°æ–¹å¼•ç”¨åˆ°è¿™å—å†…å­˜çš„ï¼Œå†æ¬¡è®¿é—®å°±ä¼šå‡ºé”™

æ­£å› ä¸ºå¦‚æ­¤ï¼ŒJavaä¸­æ‰ä¼šå‡ºç°åƒåœ¾å›æ”¶æœºåˆ¶åˆ°å¤„å»æ‰¾å“ªé‡Œæœ‰æ²¡æœ‰ä¸ç”¨äº†çš„å†…å­˜

åœ¨Rustä¸­ åœ¨let s2 = s1 è¯­å¥æ‰§è¡Œåï¼Œæˆ‘ä»¬è¯´ å †é‡Œå­—ç¬¦ä¸²çš„æ‰€æœ‰è€…ä»s1è½¬ç§»åˆ°äº†s2
å…¶å®å…·ä½“æ˜¯ï¼Œä¸¤ä¸ªæ­¥éª¤

1.  s1å˜é‡æ‹·è´ç»™s2åï¼ˆæ ˆç©ºé—´çš„æ“ä½œï¼Œè¿™æ­¥å¾ˆå¿«ï¼‰
2.  å°†s1å¤±æ•ˆ

å¦‚æœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ æµ…æ‹·è´(shallow copy) å’Œ æ·±æ‹·è´(deep copy)ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¬èµ·æ¥å°±åƒæµ…æ‹·è´ï¼Œ
ä½†æ˜¯åˆå› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡ s1 æ— æ•ˆäº†ï¼Œå› æ­¤è¿™ä¸ªæ“ä½œè¢«ç§°ä¸º ç§»åŠ¨(move)ï¼Œè€Œä¸æ˜¯æµ…æ‹·è´ã€‚

![2024-04-26-15-28-29-screenshoot.png](../assets/img/2024-04-26-15-28-29-screenshoot.png)

s1 ä¸å†æŒ‡å‘ä»»ä½•æ•°æ®ï¼Œåªæœ‰ s2 æ˜¯æœ‰æ•ˆçš„ï¼Œå½“ s2 ç¦»å¼€ä½œç”¨åŸŸï¼Œå®ƒå°±ä¼šé‡Šæ”¾å†…å­˜

æ‰€ä»¥ç§° let a = b è¿™æ ·çš„å«åšç»‘å®š



## å“ªè¿˜æœ‰é‚£äº›ä¼šå‘ç”Ÿè½¬ç§»çš„ {#orgf5ea0e9}

å…¶å®å°±è¦å»æ€è€ƒï¼Œè¿™é‡Œæœ‰æ²¡æœ‰å‘ç”Ÿ æ•°æ®äº¤äº’ï¼Œæˆ–è€…è¯´ä¸Šé¢é‚£æ ·çš„ä¼ é€’

åœ¨å‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œå‡½æ•°å‚æ•°çš„ä¼ é€’å°±æ˜¯ä¸€ç§éšè—çš„æ‰€æœ‰æƒè½¬ç§»

    fn main(){
        let s = String::from("Hello world");
        println!("{s}");
        test(s);
        //è¿™é‡Œå†å» æ‰“å° s ä¼šæŠ¥é”™
        //println!("{s}");
    }
    fn test(s:String){
        println!("{s}");
    }


```
: Hello world
: Hello world
```

å¦‚æœæŠŠmainæ–¹æ³•ä¸­ç¬¬äºŒä¸ªæ‰“å°è¯­å¥å¼€å¯çš„è¯ï¼Œä¼šå¾—åˆ°

```rust
6 |       println!("{s}");
                   ^^^ value borrowed here after move
```


è¿™æ ·çš„ä¸€ä¸ªæŠ¥é”™

åŸå› å°±åœ¨äº,mainæ–¹æ³•ä¸­ s çš„å€¼å·²ç»ç§»åŠ¨åˆ°testæ–¹æ³•ä¸­ï¼Œsä¸å†æœ‰æ•ˆ

åŒæ ·ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¹Ÿæœ‰æ‰€æœ‰æƒ

       fn main() {
        let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                            // ç§»ç»™ s1

        let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ

        let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                            // takes_and_gives_back ä¸­,
                                            // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3
    } // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
      // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

    fn gives_ownership() -> String {             // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™
                                                 // è°ƒç”¨å®ƒçš„å‡½æ•°

        let some_string = String::from("hello"); // some_string è¿›å…¥ä½œç”¨åŸŸ.

        some_string                              // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
    }

    // takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
    fn takes_and_gives_back(a_string: String) -> String { // a_string è¿›å…¥ä½œç”¨åŸŸ

        a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
    }



## é‚£ç¨‹åºä¸­è‚¯å®šæœ‰å¾ˆå¤šå€¼ä¼ æ¥ä¼ å»ï¼Œæ‰€æœ‰æƒè½¬ç§»æ¥è½¬ç§»å»ï¼Œè¿˜è¦é€šè¿‡è¿”å›å€¼å»æŠŠæ‰€æœ‰æƒæ¥å—å›æ¥ï¼Œé‚£å²‚ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Ÿ {#org5895332}

å¯¹ï¼Œå¦‚æœä»…ä»…æ”¯æŒé€šè¿‡è½¬ç§»æ‰€æœ‰æƒçš„æ–¹å¼è·å–ä¸€ä¸ªå€¼ï¼Œé‚£ä¼šè®©ç¨‹åºå˜å¾—å¤æ‚
æ‰€ä»¥Rustä¸­å¼•å…¥äº† å¼•ç”¨ æ¥è§£å†³è¿™ä¸ªé—®é¢˜

å¼•ç”¨çš„è¯­æ³•å…¶å®å’ŒC++ä¸­çš„æ˜¯ä¸€è‡´çš„
åˆ©ç”¨å¼•ç”¨äº§ç”Ÿçš„è¡Œä¸ºï¼Œåœ¨Rustä¸­ç§°ä½œå€Ÿç”¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶ä¸æ‹¥æœ‰å¯¹å€¼çš„æ‰€æœ‰æƒ

    fn main(){
        let s = String::from("hello world");
        println!("{s}");
        test(&s);
        println!("{s}");
    }

    fn test(s:&String){
        println!("inside test:{s}");
    }

```
: hello world
: inside test:hello world
: hello world
```

è¿™é‡Œtestæ–¹æ³•ä¸­ï¼Œsæ²¡æœ‰æ‹¥æœ‰ å †ä¸­å­—ç¬¦ä¸²çš„æ‰€æœ‰æƒã€‚



## æ€ä¹ˆç”¨å¼•ç”¨è·å–å€¼ï¼Ÿ {#org675c298}

ä¸Šé¢è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å¼•ç”¨ç±»å‹ï¼Œè¦æƒ³ä½¿ç”¨å€¼å°±è¦è§£å¼•ç”¨

åŒæ ·ç±»ä¼¼C/C++ä¸­çš„æŒ‡é’ˆæ“ä½œ

      fn main() {
        let x = 5;
        let y = &x;

        assert_eq!(5, x);
        assert_eq!(5, *y);
    }

\*y å°±æ˜¯è§£å¼•ç”¨



## é‚£æ„æ€æ˜¯åªæ˜¯å¯è¯»ï¼Ÿ {#org064735c}

æœ‰ç‚¹åƒå¹¶å‘ç¼–ç¨‹ï¼Œä¸€ä¸ªæ‹¥æœ‰è¯»å†™ï¼Œä¸€ä¸ªåªèƒ½è¯»ï¼Ÿ

å®Œå…¨ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä¸»è¦æ˜¯æ‰€æœ‰æƒçš„å½’å±ï¼Œå°±å†³å®šäº†è¿™ä¸ªå€¼åœ¨å“ªä¸ªä½œç”¨åŸŸç»“æŸåé‡Šæ”¾

è¿™é‡Œæ¶‰åŠåˆ° å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨çš„æ¦‚å¿µ

ä¸å¯å˜å¼•ç”¨
```rust
      fn main() {
        let s1 = String::from("hello");

        let len = calculate_length(&s1);

        println!("The length of '{}' is {}.", s1, len);
    }

    fn calculate_length(s: &String) -> usize {
        s.len()
    }
```
ä¸Šé¢å°±æ˜¯å°† s1 çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ–¹æ³• calculate_length ,è€Œä¸æ˜¯æ‰€æœ‰æƒè½¬ç§»ç»™è¿™ä¸ªæ–¹æ³•

1.  æ— éœ€åƒä¹‹å‰ï¼šå…ˆé€šè¿‡å‡½æ•°å‚æ•°ä¼ å…¥æ‰€æœ‰æƒï¼Œç„¶åå†é€šè¿‡å‡½æ•°è¿”å›æ¥ä¼ å‡ºæ‰€æœ‰æƒï¼Œä»£ç æ›´åŠ ç®€æ´
2.  calculate_length çš„å‚æ•° s ç±»å‹ä» String å˜ä¸º &String

& ç¬¦å·å³æ˜¯å¼•ç”¨ï¼Œå®ƒä»¬å…è®¸ä½ ä½¿ç”¨å€¼ï¼Œä½†æ˜¯ä¸è·å–æ‰€æœ‰æƒ

![2024-04-26-15-31-19-screenshoot.png](../assets/img/2024-04-26-15-31-19-screenshoot.png)

é€šè¿‡ &s1 è¯­æ³•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ s1 çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚

**å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œå½“å¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œå…¶æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒã€‚**

ä½†æ˜¯è¿™æ—¶å€™å»æ”¹å˜å€¼æ˜¯ä¸è¡Œçš„

    fn main(){
        let s = String::from("hello");
        change_s(&s);
        println!("{s}");
    }
    fn change_s(s:&String){
        s.push_str(" world");
    }

ä¸Šé¢ç¨‹åºä¼šæŠ¥é”™ï¼Œ


```rust
error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&` reference
 --> src/main.rs:8:5
  |
7 | fn change(some_string: &String) {
  |                        ------- help: consider changing this to be a mutable reference: `&mut String`
                           ------- å¸®åŠ©ï¼šè€ƒè™‘å°†è¯¥å‚æ•°ç±»å‹ä¿®æ”¹ä¸ºå¯å˜çš„å¼•ç”¨: `&mut String`
8 |     some_string.push_str(", world");
  |     ^^^^^^^^^^^ `some_string` is a `&` reference, so the data it refers to cannot be borrowed as mutable
                     `some_string`æ˜¯ä¸€ä¸ª`&`ç±»å‹çš„å¼•ç”¨ï¼Œå› æ­¤å®ƒæŒ‡å‘çš„æ•°æ®æ— æ³•è¿›è¡Œä¿®æ”¹

```


è¿™ä¸€æ–¹é¢æ˜¯å› ä¸º æœ¬èº« main ä¸­çš„ s å°±æ˜¯ä¸å¯å˜çš„ï¼Œå¦å¤– å¼•ç”¨ä¹Ÿæ˜¯ä¸å¯å˜å¼•ç”¨

æ‰€ä»¥è¦è¾¾åˆ°é€šè¿‡å¼•ç”¨æ”¹å˜å€¼ï¼ŒRust å¼•å…¥äº†ä¸€ä¸ªå¯å˜å¼•ç”¨

      fn main() {
        let mut s = String::from("hello");
        let s1 = &mut s;
        change(s1);
        println!("{s}");
    }

    fn change(some_string: &mut String) {
        some_string.push_str(", world");
    }

```
: hello, world
```

**å£°æ˜ s æ˜¯å¯å˜ç±»å‹ï¼Œå…¶æ¬¡åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨ &mut s å’Œæ¥å—å¯å˜å¼•ç”¨å‚æ•° some_string: &mut String çš„å‡½æ•°**

æ³¨æ„

`let s1 = &mut s` æ˜¯è¿™æ ·å†™ï¼Œè€Œä¸æ˜¯ `let &mut s1 = s` æˆ–è€… `let &mut s1 = &s`

s1 çš„ç±»å‹æ˜¯ &mut String

å¯¹äºå¯å˜å¼•ç”¨ï¼Œå› ä¸ºæ¶‰åŠåˆ°æ›´æ”¹ï¼Œæ‰€ä»¥å¯¹ä»–è¿˜æœ‰ä¸€äº›è§„åˆ™é™åˆ¶

1.  å¯å˜å¼•ç”¨åœ¨åŒä¸€ä½œç”¨åŸŸåªèƒ½å­˜åœ¨ä¸€ä¸ª

        let mut s = String::from("hello");
        let r1 = &mut s;
        let r2 = &mut s;

        println!("{}, {}", r1, r2);

    è¿™æ ·å°±ä¸è¡Œï¼Œç¬¬ä¸€ä¸ªå¯å˜å€Ÿç”¨ r1 å¿…é¡»è¦æŒç»­åˆ°æœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½® println!ï¼Œåœ¨ r1 åˆ›å»ºå’Œæœ€åä¸€æ¬¡ä½¿ç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬åˆå°è¯•åˆ›å»ºç¬¬äºŒä¸ªå¯å˜å€Ÿç”¨ r2ã€‚

    å…¶å®è¿™é‡Œåœ¨åšçš„äº‹æƒ…æ˜¯é¿å…æ•°æ®ç«äº‰ã€‚
    æ•°æ®ç«äº‰ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºå¾ˆå¯èƒ½è¶…å‡ºæˆ‘ä»¬çš„é¢„æœŸï¼Œéš¾ä»¥åœ¨è¿è¡Œæ—¶è¿½è¸ªï¼Œå¹¶ä¸”éš¾ä»¥è¯Šæ–­å’Œä¿®å¤ã€‚
    è€Œ Rust é¿å…äº†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œå› ä¸ºå®ƒç”šè‡³ä¸ä¼šç¼–è¯‘å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç ï¼

2.  å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨

        let mut s = String::from("hello");

        let r1 = &s; // æ²¡é—®é¢˜
        let r2 = &s; // æ²¡é—®é¢˜
        let r3 = &mut s; // å¤§é—®é¢˜

        println!("{}, {}, and {}", r1, r2, r3);

    å…¶å®è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£åœ¨å€Ÿç”¨ä¸å¯å˜å¼•ç”¨çš„ç”¨æˆ·ï¼Œè‚¯å®šä¸å¸Œæœ›ä»–å€Ÿç”¨çš„ä¸œè¥¿ï¼Œè¢«å¦å¤–ä¸€ä¸ªäººè«åå…¶å¦™æ”¹å˜äº†ã€‚
    å¤šä¸ªä¸å¯å˜å€Ÿç”¨è¢«å…è®¸æ˜¯å› ä¸ºæ²¡æœ‰äººä¼šå»è¯•å›¾ä¿®æ”¹æ•°æ®ï¼Œæ¯ä¸ªäººéƒ½åªè¯»è¿™ä¸€ä»½æ•°æ®è€Œä¸åšä¿®æ”¹ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ•°æ®è¢«æ±¡æŸ“ã€‚

å…³äºå¼•ç”¨ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯å¼•ç”¨çš„ä½œç”¨åŸŸ

**å¼•ç”¨çš„ä½œç”¨åŸŸ s ä»åˆ›å»ºå¼€å§‹ï¼Œä¸€ç›´æŒç»­åˆ°å®ƒæœ€åä¸€æ¬¡ä½¿ç”¨çš„åœ°æ–¹ï¼Œè¿™ä¸ªè·Ÿå˜é‡çš„ä½œç”¨åŸŸæœ‰æ‰€ä¸åŒï¼Œå˜é‡çš„ä½œç”¨åŸŸä»åˆ›å»ºæŒç»­åˆ°æŸä¸€ä¸ªèŠ±æ‹¬å· }**

      fn main() {
       let mut s = String::from("hello");

        let r1 = &s;
        let r2 = &s;
        println!("{} and {}", r1, r2);
        // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr1,r2ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ

        let r3 = &mut s;
        println!("{}", r3);
    } // è€ç¼–è¯‘å™¨ä¸­ï¼Œr1ã€r2ã€r3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
      // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ

åœ¨è€ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ä¸­ï¼ˆRust 1.31 å‰ï¼‰ï¼Œå°†ä¼šæŠ¥é”™ï¼Œå› ä¸º r1 å’Œ r2 çš„ä½œç”¨åŸŸåœ¨èŠ±æ‹¬å· } å¤„ç»“æŸï¼Œé‚£ä¹ˆ r3 çš„å€Ÿç”¨å°±ä¼šè§¦å‘ æ— æ³•åŒæ—¶å€Ÿç”¨å¯å˜å’Œä¸å¯å˜çš„è§„åˆ™ã€‚

ä½†æ˜¯åœ¨æ–°çš„ç¼–è¯‘å™¨ä¸­ï¼Œè¯¥ä»£ç å°†é¡ºåˆ©é€šè¿‡ï¼Œå› ä¸º å¼•ç”¨ä½œç”¨åŸŸçš„ç»“æŸä½ç½®ä»èŠ±æ‹¬å·å˜æˆæœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½®ï¼Œå› æ­¤ r1 å€Ÿç”¨å’Œ r2 å€Ÿç”¨åœ¨ println! åï¼Œå°±ç»“æŸäº†ï¼Œæ­¤æ—¶ r3 å¯ä»¥é¡ºåˆ©å€Ÿç”¨åˆ°å¯å˜å¼•ç”¨ã€‚

å¯¹äºè¿™ç§ç¼–è¯‘å™¨ä¼˜åŒ–è¡Œä¸ºï¼ŒRust ä¸“é—¨èµ·äº†ä¸€ä¸ªåå­— â€”â€” Non-Lexical Lifetimes(NLL)ï¼Œä¸“é—¨ç”¨äºæ‰¾åˆ°æŸä¸ªå¼•ç”¨åœ¨ä½œç”¨åŸŸ(})ç»“æŸå‰å°±ä¸å†è¢«ä½¿ç”¨çš„ä»£ç ä½ç½®ã€‚



## è¯¶ï¼Ÿä¼šä¸ä¼šæœ‰ä¸€ç§æƒ…å†µæ˜¯åŸæ¥çš„å€¼è¢«é‡Šæ”¾äº†ï¼Œä½†æ˜¯å¼•ç”¨è¿˜åœ¨ï¼Œæ€ä¹ˆåŠï¼Ÿ {#org50a7178}

å…¶å®è¿™ç§ç°è±¡å« æ‚¬å‚å¼•ç”¨ Dangling References ä¹Ÿå«æ‚¬å‚æŒ‡é’ˆ

æˆ‘æ„Ÿè§‰åœ¨å•çº¿ç¨‹ä¸­ï¼Œå› ä¸ºæ˜¯é¡ºåºæ‰§è¡Œï¼Œå’Œå‡½æ•°æ ˆå¸§ä¿è¯, å› ä¸ºåªæ˜¯ä¼ é€’å¼•ç”¨ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯è°ƒç”¨æ–¹å§‹ç»ˆæœ‰æ‰€æœ‰æƒï¼Œè€Œä»–ä¹Ÿæ˜¯å†³å®šæ‰€æœ‰æƒä½œç”¨åŸŸçš„ä¸€æ–¹ï¼Œé‚£å°±æ²¡äº‹

é™¤éæ˜¯æœ‰ä¸€ç§æ–¹å¼,å°±æ˜¯ åˆ©ç”¨å‡½æ•°è¿”å›å€¼ï¼Œè¿”å›ä¸€ä¸ªå¼•ç”¨,æ¥åˆ¶é€ ä¸€ä¸ªæ‚¬å‚æŒ‡é’ˆ

    fn main(){
        let dangeling_references = dangle();
    }
    fn dangle()->&String{
        let s = String::from("hello");
        &s
    }

ä¸Šé¢æ‰§è¡Œä¼šæŠ¥é”™
```rust
error[E0106]: missing lifetime specifier
 --> src/main.rs:5:16
  |
5 | fn dangle() -> &String {
  |                ^ expected named lifetime parameter
  |
  = help: this function's return type contains a borrowed value, but there is no value for it to be borrowed from
help: consider using the `'static` lifetime
  |
5 | fn dangle() -> &'static String {
  |                ~~~~~~~~

```

ä¸»è¦æ˜¯è¿™å¥
this function's return type contains a borrowed value, but there is no value for it to be borrowed from.
è¯¥å‡½æ•°è¿”å›äº†ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œä½†æ˜¯å·²ç»æ‰¾ä¸åˆ°å®ƒæ‰€å€Ÿç”¨å€¼çš„æ¥æº

1.  åŒä¸€æ—¶åˆ»ï¼Œä½ åªèƒ½æ‹¥æœ‰è¦ä¹ˆä¸€ä¸ªå¯å˜å¼•ç”¨, è¦ä¹ˆä»»æ„å¤šä¸ªä¸å¯å˜å¼•ç”¨
2.  å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„



## æ‰€æœ‰æƒç³»ç»Ÿæ€ä¹ˆä¿è¯å†…å­˜å®‰å…¨ï¼Ÿ     :drill: {#org48360e0}

æ²¡ç”¨äº†ç«‹é©¬ä¸¢æ‰

æ€ä¹ˆæ‰ç®—æ²¡ç”¨äº†

å˜é‡æ‰€åœ¨çš„scopeç»“æŸï¼Œç”Ÿå‘½å‘¨æœŸç»“æŸäº†å°±æ²¡ç”¨äº†

é™¤éæ‰€æœ‰æƒè½¬ç§»èµ°ï¼Œä¸ç„¶æ²¡æœ‰æ‰€æœ‰è€…äº†å°±æ˜¯æ²¡ç”¨äº†



### æˆ‘çš„æ€è€ƒ {#org41ca34d}

å†…å­˜ä¸å®‰å…¨çš„åŸå› æ˜¯å› ä¸ºåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™å †é‡Œçš„æ•°æ®å¯¹è±¡å­˜åœ¨å¤šä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å†³å®šä»€ä¹ˆæ—¶å€™è¦å›æ”¶æ‰å®ƒ

é‚£ä¹ˆåªè¦ä»»ä½•æ—¶å€™åªå­˜åœ¨ä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆéšç€è¦ç”¨åˆ°å®ƒçš„å˜é‡ç»“æŸäº†ï¼Œé‚£ä¹ˆå †é‡Œçš„æ•°æ®å¯¹è±¡è‡ªç„¶å°±å¯ä»¥è·Ÿç€å›æ”¶æ‰ã€‚



# æ¡ˆä¾‹åˆ†æ {#orgd48212f}

      fn main(){
        let mut s  = String::from("hello");
        println!("The memory address of s is: {:p}", &s as *const String);
        s = String::from("world");
        println!("The momory address os s is: {:p}", &s as *const String);
    }

```
: The memory address of s is: 0x7ff7b2ecc8b0
: The momory address os s is: 0x7ff7b2ecc8b0
```

First, I'm just curious about how Rust deal with the old value String "hello"
Because the doc says

Each value in Rust has an owner.
So I assume what happened here is new memory is allocated on the heap and given the value "world".
Then s own the value "world" which results in the dropping of "hello"

But it seems there is no move happen.
as a result, it's more like replacing, the String "world" replace the "hello". They have the save memory



## é‚£è¿™é‡Œç¨‹åºåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ‰€æœ‰æƒæ˜¯æ‹¥æœ‰å€¼è¿˜æ˜¯æ‹¥æœ‰å†…å­˜ç©ºé—´ {#org14c9248}

ä¸Šé¢çš„ç¨‹åºï¼Œæˆ‘æƒ³çš„æ˜¯æ‰“å° så˜é‡å¯¹åº”çš„å †å†…å­˜é‡Œé¢çœŸæ­£ä¿å­˜å­—ç¬¦ä¸²çš„åœ°å€

ä½†å…¶å®è¿™é‡Œæ‰“å°çš„æ˜¯æ ˆä¸­çš„åœ°å€

    fn main(){
        let mut s  = String::from("hello");
        println!("The memory address of s is: {:p}", &s as *const String);
        println!("The memory address of *s is: {:p}", &*s as *const str);
        s = String::from("world");
        println!("The memory address of s is: {:p}", &s as *const String);
        println!("The memory address of *s is: {:p}", &*s as *const str);
    }

æˆ–è€…

      fn main(){
        let mut s  = String::from("hello");
        println!("The memory address of s is: {:?}", s.as_ptr());
        s = String::from("world");
        println!("The momory address os s is: {:?}", s.as_ptr());
    }

ç„¶åç”¨as_str ä¹Ÿè¡Œ

      fn main(){
        let mut s  = String::from("hello");
        println!("The memory address of s is: {:p}", s.as_str());
        s = String::from("world");
        println!("The momory address os s is: {:p}", s.as_str());
    }

å› ä¸ºè¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯ {:p} æ ¼å¼åŒ–è¾“å‡º &Tçš„åœ°å€ åŒ…æ‹¬&str
ï¼Œç„¶å s.as_str()çš„åˆ°çš„æ˜¯ &strï¼Œä¹Ÿå°±æ˜¯â€œhelloâ€

è¿™æ ·å¯ä»¥çœ‹åˆ°åœ°å€æ˜¯ä¸ä¸€æ ·çš„

å›åˆ°ä¸Šé¢ç¨‹åº

In general ownership has two aspects:

1.  The right to move the value anywhere in memory, and
2.  The responsibility to drop the value when it is no longer available.

For a type like String, there are two chunks of memory to consider:

-   The string value itself, which is a (pointer, length) pair.
    **this is stored on the stack** in a fixed location;
    this is the location that you're printing
-   **The heap buffer where the actual characters are stored**,
    which you can get the address of via String::as_str()

**The line s = String::from("world") first drops the original string value,**
**which deallocates the heap buffer containing "hello".**
**It then stores a pointer, etc. to a new heap buffer that contains "world"**
**into the same stack location the old pointer was stored in.**

At the end of main, the contents of the s variable are dropped just before the stack frame goes away,
deallocating the buffer containing "world".
